function setup() {
  createCanvas(400, 400);
}

function draw() {
  background(255);
}

let teapotPieces = [];
let numPieces = 27 * 18;
let teapotSize = 400;
let pieceSize = 11;
let sizeFactors =
    [[0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 0.4, 0.4, 0.4, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.4, 0.4, 0.4, 0.4, 0.7, 0.7, 0.7, 0.5],
     [0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 0.4, 0.4, 0.4, 0.2, 0.2, 0.2, 1.0, 1.0, 1.0, 0.2, 0.2, 0.2, 0.4, 0.4, 0.4, 0.4, 0.4, 0.7, 0.7, 0.7, 0.5],
     [0.7, 0.7, 0.7, 0.4, 0.7, 0.4, 0.4, 0.4, 0.4, 0.3, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.4, 0.4, 0.4, 0.4, 0.4, 0.7, 0.7, 0.7, 0.5],
     [0.5, 0.7, 0.7, 1.0, 1.0, 1.0, 1.0, 0.4, 1.0, 1.2, 1.0, 1.0, 1.3, 1.3, 1.3, 1.3, 1.0, 1.0, 0.4, 0.4, 0.4, 0.4, 0.4, 1.0, 1.0, 1.0, 0.5],
     [0.5, 0.7, 1.0, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, 0.4, 0.4, 0.4, 0.4, 1.0, 1.0, 1.0, 0.5],
     [0.5, 1.0, 1.0, 0.3, 0.3, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 0.4, 1.0, 1.0, 1.0, 0.2, 0.5],
     [0.5, 1.2, 1.0, 0.3, 0.3, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.3, 0.5],
     [0.5, 1.0, 1.0, 0.3, 0.3, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 0.5],
     [0.5, 1.0, 1.0, 0.3, 0.3, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.7, 0.5],
     [0.5, 1.0, 1.0, 0.3, 0.3, 0.2, 0.9, 1.0, 1.0, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.7, 0.5],
     [0.5, 0.7, 1.2, 1.0, 0.3, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.7, 0.5],
     [0.5, 0.7, 0.7, 1.2, 1.0, 0.2, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.2, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 1.0, 1.0, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 0.2, 0.2, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 0.7, 1.0, 0.9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 0.4, 0.2, 0.4, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.3, 0.4, 0.4, 0.4, 0.4, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 0.4, 0.4, 0.4, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.4, 1.0, 1.0, 0.3, 0.4, 0.4, 0.4, 0.4, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 0.4, 0.4, 0.4, 0.4, 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.4, 0.4, 0.4, 0.3, 0.4, 0.4, 0.7, 0.7, 0.7, 0.5],
     [0.5, 0.7, 0.7, 0.7, 0.7, 0.7, 0.4, 0.4, 0.4, 0.4, 0.4, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.4, 0.3, 0.4, 0.4, 0.7, 0.7, 0.7, 0.5]]

function setup() {
  createCanvas(800, 600, WEBGL);
  noStroke();
  fill(255);
  // create the teapot pieces
  for (let i = 0; i < numPieces; i++) {
    teapotPieces.push(createTeapotPiece());
  }
}

function draw() {
  background(0);
  // draw each teapot piece
  let count = 0;
  for (let x = 0; x < 27; x++) {
    for (let y = 0; y < 18; y++) {
      let piece = teapotPieces[count];
      push();
      translate((x-13) * pieceSize * 2, (y-8) * pieceSize * 2, 0);
      rotateX(piece.rotation.x);
      rotateY(piece.rotation.y);
      rotateZ(piece.rotation.z);
      scale(pieceSize * sizeFactors[y][x]);
      beginShape();
      for (let i = 0; i < piece.vertices.length; i++) {
        vertex(piece.vertices[i].x, piece.vertices[i].y, piece.vertices[i].z);
      }
      endShape(CLOSE);
      pop();
      count++;
    }
  }
}

// create a random teapot piece
function createTeapotPiece() {
  let piece = {};
  piece.rotation = createVector(random(-PI, PI), random(-PI, PI), random(-PI, PI));
  let numVertices = floor(random(3, 5));
  piece.vertices = [];
  for (let i = 0; i < numVertices; i++) {
    let angle = i * TWO_PI / numVertices;
    let radius = random(0.5, 1);
    let x = radius * cos(angle);
    let y = radius * sin(angle);
    piece.vertices.push(createVector(x, y, 0));
  }
  return piece;
}